---
title: "SORTIE Carbon Extension Note"
author: "Leah Walker"
date: "2022-08-29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(data.table)
library(plyr)
library(dplyr)
library(xml2)
library(stringr)
library(tidyr)
library(ggplot2)
library(Rmisc)
library(lme4)
library(lmerTest)
library(rsortie)

source("./R/clean_summit_lake_data.R")
source("./R/calc_field_BA.R")
source("../Carbon/CarbonFunctions.R")
source("../Carbon/AllometryFunctions.R")
source("./R/calc_field_C.R")

BA.function <- function(DBH) {pi*(DBH/200)^2}

path_outputs <- "./Outputs/"

```



1. Set parameters
- run makeFiles
- run rsortie
- clean field data
- calculate carbon
- calculate field carbon
- calculate field carbon by species

```{r}
###################
### Summit Lake ###
###################



##################
### Date Creek ###
##################



```



2. Read in data

```{r}
###################
### Summit Lake ###
###################

### Field ###
# LIVE
SL_field_L_C <- read.csv("./Outputs/csv/SummitLake_C_field_L.csv") # SL = Summit Lake, L = living, C = carbon

# Live - Hybrid Spruce (Sx)
SL_field_L_C_Sx <- read.csv("./Outputs/csv/SummitLake_C_field_L_Sx.csv")

# Live - Subalpine fir (Bl)
SL_field_L_C_Bl <- read.csv("./Outputs/csv/SummitLake_C_field_L_Bl.csv")



# DEAD
SL_field_D_C <- read.csv("./Outputs/csv/SummitLake_C_field_D.csv") # D = dead



### Sortie ###

#LIVE
SL_L_C <- read.csv(paste0(path_outputs, "csv/SummitLake_C_0506_L.csv"))
# This data frame will be used below to calculate carbon per species

SL_L_C_u <- SL_L_C %>% # u = unit (this data frame is summarized to the unit level)
  dplyr::select(unit, timestep, C_unit, treatment)

SL_L_C_u <- as.data.table(unique(SL_L_C_u))



# DEAD
SL_D_C <- read.csv(paste0(path_outputs, "csv/SummitLake_C_0506_D.csv"))
# This data frame will be used below to calculate carbon per species

SL_D_C_u <- SL_D_C %>%
  dplyr::select(unit, timestep, C_unit, treatment)

SL_D_C_u <- as.data.table(unique(SL_D_C_u))



##################
### Date Creek ###
##################

### Field ###
# LIVE
DC_field_L_C <- read.csv(paste0(path_outputs, "csv/DateCreek_C_field_L.csv")) # DC = Date Creek, L = living, C = carbon

# Live - Western red cedar (Cw)
DC_field_L_C_Cw <- read.csv("./Outputs/csv/DateCreek_C_field_L_Cw.csv.csv")

# Live - Western hemlock (Hw)
DC_field_L_C_Hw <- read.csv("./Outputs/csv/DateCreek_C_field_L_Hw.csv")



# DEAD
DC_field_D_C <- read.csv(paste0(path_outputs, "csv/DateCreek_C_field_D.csv"))



### Sortie ###

# LIVE
DC_L_C <- read.csv(paste0(path_outputs, "csv/DateCreek_C_L.csv")) # DC = Date Creek, L = living, C = carbon
# This data frame will be used below to calculate carbon per species

DC_L_C_p <- DC_L_C %>% # p = plot (this data frame is summarized to the plot level)
  dplyr::select(timestep, Unit, PlotNumber, C_plot, Treatment) 

DC_L_C_p <- unique(DC_L_C_p)

DC_L_C_p <- DC_L_C_p %>% # u = unit
  dplyr::group_by(timestep, Unit) %>% 
  dplyr::mutate(C_unit = sum(C_plot, na.rm = TRUE)/count)

DC_L_C_u <- DC_L_C_p %>% # u = unit
  dplyr::select(timestep, Unit, C_unit, Treatment) 

DC_L_C_u <- as.data.table(unique(DC_L_C_u))



# DEAD
DC_D_C <- read.csv(paste0(path_outputs, "csv/DateCreek_C_D.csv")) # DC = Date Creek, L = living, C = carbon
# This data frame will be used below to calculate carbon per species

DC_D_C_p <- DC_D_C %>% # p = plot (this data frame is summarized to the plot level)
  dplyr::select(timestep, Unit, PlotNumber, C_plot, Treatment) 

DC_D_C_p <- unique(DC_D_C_p)

DC_D_C_p <- DC_D_C_p %>% # u = unit
  dplyr::group_by(timestep, Unit) %>% 
  dplyr::mutate(C_unit = sum(C_plot, na.rm = TRUE)/count)

DC_D_C_u <- DC_D_C_p %>% # u = unit
  dplyr::select(timestep, Unit, C_unit, Treatment) 

DC_D_C_u <- as.data.table(unique(DC_D_C_u))

```



3. Live standing carbon
```{r}
###################
### Summit Lake ###
###################



##################
### Date Creek ###
##################



```



4. Dead standing carbon
```{r}
###################
### Summit Lake ###
###################



##################
### Date Creek ###
##################



```



5. Carbon by species
```{r}
###################
### Summit Lake ###
###################

### Interior spruce ###

# Subset for Spruce
SL_L_C_Sx <- subset(SL_L_C, SL_L_C$Species == "Sx")

# Recalculate C per unit for spruce only
SL_L_C_Sx <- SL_L_C_Sx %>% 
  group_by(timestep, unit) %>% 
  mutate(C_unit = sum(C_tree, na.rm = TRUE))

# Select desired columns
SL_L_C_Sx <- SL_L_C_Sx %>%
  dplyr::select(unit, timestep, C_unit, treatment)

SL_L_C_Sx <- as.data.table(unique(SL_L_C_Sx))



### Subalpine fir ###

# Subset for Fir
SL_L_C_Bl <- subset(SL_L_C, SL_L_C$Species == "Bl")

# Recalculate C per unit for spruce only
SL_L_C_Bl <- SL_L_C_Bl %>% 
  group_by(timestep, unit) %>% 
  mutate(C_unit = sum(C_tree, na.rm = TRUE))

# Select desired columns
SL_L_C_Bl <- SL_L_C_Bl %>%
  dplyr::select(unit, timestep, C_unit, treatment)

SL_L_C_Bl <- as.data.table(unique(SL_L_C_Bl))



##################
### Date Creek ###
##################

### Western redcedar ###

DC_L_C_Cw <- subset(DC_L_C, DC_L_C$Species == "Cw")

# Recalculate C per unit for cedar only
DC_L_C_Cw_p <- DC_L_C_Cw %>% 
  group_by(timestep, Unit, PlotNumber) %>% 
  mutate(C_plot = sum(C_tree, na.rm = TRUE))

# Select desired columns
DC_L_C_Cw_p <- DC_L_C_Cw_p %>% 
  select(timestep, Unit, PlotNumber, C_plot, Treatment, count)

DC_L_C_Cw_p <- unique(DC_L_C_Cw_p)

# Calculate carbon per unit by averaging carbon per plot
DC_L_C_Cw_u <- DC_L_C_Cw_p %>% 
  group_by(timestep, Unit) %>% 
  mutate(C_unit = sum(C_plot, na.rm = TRUE)/count)

# Select desired columns
DC_L_C_Cw_u <- DC_L_C_Cw_u %>% 
  select(timestep, Unit, C_unit, Treatment)

DC_L_C_Cw_u <- unique(DC_L_C_Cw_u)



### Western hemlock ###

DC_L_C_Hw <- subset(DC_L_C, DC_L_C$Species == "Hw")

# Recalculate C per plot for hemlock only
DC_L_C_Hw_p <- DC_L_C_Hw %>% 
  group_by(timestep, Unit, PlotNumber) %>% 
  mutate(C_plot = sum(C_tree, na.rm = TRUE))

# Select desired columns
DC_L_C_Hw_p <- DC_L_C_Hw_p %>% 
  select(timestep, Unit, PlotNumber, C_plot, Treatment, count)

DC_L_C_Hw_p <- unique(DC_L_C_Hw_p)

# Calculate carbon per unit by averaging carbon per plot
DC_L_C_Hw_u <- DC_L_C_Hw_p %>% 
  group_by(timestep, Unit) %>% 
  mutate(C_unit = sum(C_plot, na.rm = TRUE)/count)

# Select desired columns
DC_L_C_Hw_u <- DC_L_C_Hw_u %>% 
  select(timestep, Unit, C_unit, Treatment)

DC_L_C_Hw_u <- unique(DC_L_C_Hw_u)


```



6. Coarse woody debris 
```{r}
###################
### Summit Lake ###
###################



##################
### Date Creek ###
##################




```





